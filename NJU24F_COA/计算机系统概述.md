# 计算机系统概述

[TOC]

## 计算机发展历程

### 计算机系统

硬件 + 软件

### 硬件的发展

1. 电子管时代
2. 晶体管时代
3. 中小规模集成电路时代
4. 大规模, 超大规模集成电路时代

#### 摩尔定律 (补充)

- 当**价格不变**时, 单芯片上所能包含的晶体管数量每年翻一番 (1965-1969) / 1970年起减慢为每18个月翻一番
- 影响
  - 更小的尺寸带来更多**灵活性**和**可能性**
  - 由于单个芯片的成本几乎不变, 计算机逻辑电路和存储电路的**成本**显著下降
  - 减小了对**电能消耗和冷却**的要求
  - 集成电路上的内部连接比焊接更可靠, **芯片间的连接更少**

### 软件的发展

### 目前的发展趋势

- 更微型, 多用途
- 更巨型, 超高速

## 计算机硬件的基本组成

### 早期冯诺依曼机

(普林斯顿结构)

首次提出"存储程序"概念 (最重要的思想)

- 任何要计算机完成的工作都要先被编写成程序, 然后将程序和原始数据送入主存并启动执行. 一旦程序被启动, 计算机应能在不需要操作人员干预下, 自动完成逐条取出指令和执行指令的任务. 

三个基本原则: 二进制, 存储程序, 5个组成部分

- 指令和数据按二进制表示
- 存储程序
- 组成:存储器 运算器 控制器 I/O设备
- 指令和数据以同等地位存于存储器, 可按地址寻访
- 指令由操作码和地址码组成
- 以**运算器**为中心

在计算机系统中, **软件和硬件在逻辑上是等效的** (一个功能既可以使用软件, 也可以使用硬件来实现, 例如乘法可以设计一个专门的硬件电路来实现, 也可以执行多次加法运算来实现)

### 现代计算机

以**存储器**为中心

- 组成
  - CPU = 运算器 + 控制器 (与主存储器交互)
  - 主存储器
  - I/O设备 (与主存储器交互, 包含辅存)

## 各个硬件的工作原理

### 主存储器的基本组成

存储体 MAR (存储地址寄存器) MDR (存储数据寄存器)

存储单元, 存储字 (存储字长)

存储元

地址

### 运算器的基本组成

**ALU**: 算术逻辑单元

ACC: 累加器, 存放操作数或运算结果

MQ: 乘商寄存器

x: 通用操作数寄存器

### 控制器的基本组成

**CU**: 控制单元, 分析指令, 给出控制信号

IR: 指令寄存器, 存放当时执行的指令

PC: 程序计数器, 存放下一条指令地址, 能自动加1

### 计算机工作过程

- 必经步骤 (取指, 译码)
  - (PC) -> MAR
  - M(MAR) -> MDR
  - (MDR) -> IR
  - (PC) + 1 -> PC
  - OP(IR) -> CU
- 具体不同指令的步骤 (执行) ...

## 计算机系统的层次结构

- 微程序机器 M0 (微指令系统) 由硬件直接执行微指令 (取指, 译码, 执行...)
- 传统机器 M1 (用机器语言的机器) 执行二进制机器指令
- 虚拟机器 M2 (操作系统机器) 向上提供 "广义指令" (系统调用)
- 虚拟机器 M3 (汇编语言机器) 用汇编程序翻译成机器语言程序 (一一对应 )
- 虚拟机器 M4 (高级语言机器) 用编译程序翻译成汇编语言程序
- 硬件: M0, M1; 软件: M2, M3, M4.
- 下层是上层的基础, 上层是下层的扩展

### 三种级别的语言

机器语言, 汇编语言, 高级语言

- 编译程序: 将高级语言一次全部翻译为汇编/机器语言
- 汇编程序: 将汇编语言翻译成机器语言
- 解释程序: 将高级语言翻译为机器语言但翻译一句执行一句

### 体系结构 vs 组成原理

- 计算机体系结构: 如果设计硬件和软件之间的接口 (有无乘法指令)
  - 机器语言程序员所见到的计算机系统的属性概念性的结构与功能特性, 对程序员可见 (指令系统, 数据类型, 寻址技术, I/O机理)
- 计算机组成原理: 如何用硬件实现所定义的接口 (如何实现乘法指令)
  - 实现计算机体系结构所体现的属性, 对程序员不可见 (具体指令的实现)

## 计算机性能指标

### 存储器

MAR位数反映存储单元个数 (最多支持多少个存储单元)

MDR位数 = 存储字长 = 每个存储单元的大小

总容量 = 存储单元个数 × 存储字长 bit = 存储单元个数 × 存储字长 / 8 Byte

### CPU

计算机设计的主要目标是: **提高CPU性能**

- CPU主频: CPU内数字脉冲信号振荡的频率, 主频 (时钟频率=  1 / CPU时钟周期)

- CPI: Clock cycle Per Instruction 执行一条指令所需的时钟周期数 (一般看平均)

- 执行一条指令的耗时 = CPI × CPU时钟周期

- CPU执行时间 = CPU执行一个程序的耗时 = CPU时钟周期数 / 主频  = (指令条数 × CPI) / 主频

- IPS: Instructions Per Second 每秒执行多少条指令 = 主频 / 平均CPI

- FLOPS: Floating-point Operations Per Second 每秒执行多少次浮点运算 (基数为10)

### 性能设计基本原则 (补充)

- **大概率事件优先原则**
  - 对于大概率事件 (或最常见的事件), 赋予它优先的处理权和资源使用权
- **Amdahl定律**
  - 加快某部件执行速度所获得的系统性能加速比, 受限于该部件在系统中所占的重要性比例
  - 性能增加的递减规则: 如果仅仅对计算机中的一部分做性能改进, 改进越多, 系统获得的效果越小.

### 系统整体性能指标

数据通路带宽: 数据总线一次所能并行传送信息的位数 (各硬件部件通过数据总线传输数据)

吞吐量: 指系统在单位时间内处理请求的数量

响应时间: 指从用户向计算机发送一个请求, 到系统对该请求做出响应并获得它所需要的结果的等待时间

基准程序: 跑分软件, 能够测出可以比较的性能

## 计算机设计问题概述 (补充)

### CPU

- **中央处理单元** (Central Processing Unit, CPU): 获取并执行指令的计算机组成部分, 它由一个ALU, 一个控制单元和多个寄存器构成. 在单处理单元系统中, 它通常简称为**处理器**.
- **处理器**: 含有一个或多个内核的物理硅片. 处理器是计算机组件, 用于解释和执行指令. 如果一个处理器包含多个内核, 则称其位**多核处理器**

电场效应 场效应管 门电路 芯片

**问题1: CPU的频率不能无限提高**

- 理论限制
  - MOS管开关、脉冲通过门电路需要时间
  - 为了信号同步, 每个脉冲信号需要持续一定的时间
- 制造限制
  - 芯片面积越来越大, 导致连线延迟越来越大, 需要保证信号在设计指定时钟周期内从芯片的一角到达另一角
  - 频率越高（即MOS管的开关频率也越高）会导致开关损耗也越高, CPU耗电和散热会提高

**解决1: 改进CPU芯片结构**

- 晶体管数量的增加为更先进、更复杂的体系结构提供了基础
- 领域定制: 如面向人工智能的芯片

**问题2: 内存墙的存在**

- 主存和CPU之间传输数据的速度跟不上CPU的速度
- 从1980年到2010年: 
  - CPU的时钟频率提高了**2500**倍
  - 内存的访问速度提高了**9**倍, 但存储空间提升了**125000**倍。

**解决2: 采用高速缓存 (Cache)**

- 添加一级或多级缓存以减少存储器访问频率并提高数据传输速率
- 增大总线的数据宽度, 来增加每次所能取出的位数

**问题3: CPU等待I/O传输数据** 

- CPU 在等待 I/O 设备时保持空闲

**解决3: 采用中断机制**

- 将中断周期加入指令周期 
- 顺序中断处理
- 嵌套中断处理

### 存储器

- 指令和数据存储在单个读写存储器中
- 主存中的内容按位置访问, 无需考虑其中包含的类型

**问题4: 兼顾存储容量、速度和成本**

- 约束
  - 容量: 越大越好
  - 速度: 跟上处理器
  - 成本: 相对于其他组件合理
- 约束之间的关系
  - 更短的访问时间, 更高的每比特成本 

**解决4: 层次式存储结构**

- 使用存储器层次结构而不是依赖单个存储器组件 

***内存与主存***

- *在 NJU-COA 课程及相关作业中, 主存不等同于内存, 内部存储器 (内存) 包含寄存器, 高速缓存和主存*

### I/O模块

**问题5: I/O设备传输速率差异大**

- I/O性能跟不上CPU速度的提升

**解决5: 采用缓冲区和改进I/O操作技术**

- 设立缓冲区

  新的接口技术 

  不同的I/O操作技术

### 总线

**问题6: 计算机部件互连复杂**

- 早期, 组件之间用分散方式相连

**解决6: 采用总线** 

- 数据传输类型
  - 控制线: 控制数据线和地址线的访问和使用 
  - 地址线: 指定数据总线和地址I/O端口上数据的来源或去向
  - 数据线: 在系统模块之间传送数据