# 应用层

## 概述

应用层对应用程序的通信提供服务.

### 协议定义

- 应用进程交换的报文类型, 请求还是响应?
- 各种报文类型的语法, 如报文中的各个字段及其详细描述.
- 字段的语义, 即包含在字段中的信息的含义.
- 进程何时, 如何发送报文, 以及对报文进行响应的规则.

### 功能

- 文件传输, 访问和管理
- 电子邮件
- 虚拟终端
- 查询服务和远程作业登录

### 重要协议

- FTP
- SMTP, POP3
- HTTP
- DNS

## 网络应用模型

### 客户/服务器模型

C/S 模型

- 服务器: 提供计算服务的设备
  - 本质上也是一台 (性能强悍的) 主机.
  - 永久提供服务
  - 永久性访问地址/域名
- 客户机: 请求计算服务的主机
  - 与服务器通信, 使用服务器提供的服务
  - 间歇性接入网络
  - 可能使用动态IP地址
  - 不与其他客户机直接通信
- 特点
  - 客户, 服务器地位不平等
  - 客户之间不直接通信
  - 如果服务器损坏, 影响全局
  - 服务器负载较大
- 应用: Web, 文件传输FTP, 远程登录, 电子邮件

### P2P模型

Peer-to-peer

- 不存在永远在线的服务器
- 每个主机既可以提供服务, 也可以请求服务
  - 主机之间地位平等
  - 主机之间直接通信
- 任意端系统/节点之间可以直接通讯
- 节点间歇性接入网络
- 节点可能改变IP地址
- 可扩展性好
- 网络健壮性强
  - 单个节点损坏不影响全局
  - 各节点可以分摊负载
- 实例: BT种子下载

## 域名系统DNS

DNS服务的作用: 将域名解析成IP地址.

### 域名

树状结构

![](../0_Attachment/Pasted%20image%2020241209134934.png)

### 域名服务器

![](../0_Attachment/Pasted%20image%2020241209135216.png)

### 域名解析过程

- 递归查询
- 迭代查询
- ![](../0_Attachment/Pasted%20image%2020241209135331.png)

## 文件传输协议FTP

File Transfer Protocol

提供不同种类主机系统(硬, 软件体系等都可以不同)之间的文件传输能力.

### 服务器和用户端

FTP是基于客户/服务器(C/S)的协议.

用户通过一个客户机程序连接至在远程计算机上运行的服务器程序.

依照 FTP协议提供服务, 进行文件传送的计算机就是FTP服务器

连接FTP服务器, 遵循FTP协议与服务器传送文件的电脑就是FTP客户端

使用TCP实现可靠传输

### 工作原理

#### 登录

- ftp地址 用户名&密码
- ftp地址 匿名登录

#### 进程

- 一个FPT服务器进程拥有1个主进程和n个从属进程
- **控制连接**始终保持
- **数据连接**保持一会
- 是否使用TCP 20端口建立数据连接与传输模式有关
  - 主动方式使用TCP 20端口
  - 被动方式由服务器和客户端自行协商决定 (端口>1024)
- ![](../0_Attachment/Pasted%20image%2020241209142040.png)

#### 传输模式

- 文本模式:ASCII模式, 以文本序列传输数据
- 二进制模式:Binary模式, 以二进制序列传输数据

## 电子邮件

### 概述

#### 信息格式

![](../0_Attachment/Pasted%20image%2020241209142227.png)

#### 组成结构

![](../0_Attachment/Pasted%20image%2020241209142251.png)

### 协议

#### 简单邮件传送协议SMTP

- 分为连接建立, 邮件发送, 连接释放三个阶段
- ![](../0_Attachment/Pasted%20image%2020241209142655.png)
- 缺点
  - SMTP不能传送可执行文件或者其他二进制对象
  - SMTP仅限于传送7位ASCI码, 不能传送其他非英语国家的文字
  - SMTP服务器会拒绝超过一定长度的邮件.

#### 通用因特网邮件扩充MIME

- 使电子邮件系统可以支持声音, 图像, 视频, 多种国家语言等等. 使得传输内容丰富多彩
- ![](../0_Attachment/Pasted%20image%2020241209142637.png)

#### 邮局协议POP3

工作方式

- 下载并保留在服务器
- 下载并删除

#### 网际报文存取协议IMAP

- IMAP协议比POP协议复杂. 当用户PC上的IMAP客户程序打开IMAP服务器的邮箱时, 用户可以看到邮箱的首部,若用户需要打开某个邮件, 该邮件才上传到用户的计算机上.
- IMAP可以让用户在不同的地方使用不同的计算机随时上网阅读处理邮件, 还允许只读取邮件中的某一个部分 (先看正文, 有Wi-Fi的时候再下载附件)

#### 基于万维网的电子邮件

- 方便
- ![](../0_Attachment/Pasted%20image%2020241209142911.png)

## 万维网WWW

World Wide Web, 是一个全球范围的, 分布式, 联机式的信息存储空间, 各"种资源"通过**HTTP协议**传送给用户

### 组成

#### 统一资源定位符URL

- URL= `<协议>://<主机>:<端口>/<路径>`, 指向万维网上的某个特定资源
- 端口, 路径可以省去, 因为有默认值, 如: Web服务器默认80端口, 默认首页`index.html`

#### 超文本传输协议HTTP

- 应用层, 基于TCP. HTTP协议定义了**HTTP请求报文**, **HTTP响应报文**两种数据结构

#### 超文本标记语言HTML

- 一种文档结构的标记语言, 使用一些约定的标记对页面上的各种信息 (包括文字, 图像, 视频等), 格式进行描述.

### HTTP

#### 访问一个网页的过程

- 一个网页 = 1个html文件+n个网页元素 (本质上是文件)
- 每个文件的获取都需要经过一组HTTP请求&响应
- 注意: 只有**先获得html文件**, 才能知道其他n个被引用的网页元素的URL

#### HTTP协议的工作方式

- 非持续连接
  - 特点: 每建立一次TCP连接, 仅完成一组HTTP请求&响应
  - 可以通过**并行TCP连接**加快获取n个网页元素的速度
- 持续连接
  - 特点: 每建立一次TCP连接, 可以完成多组HTTP请求&响应
  - 分类
    - 非流水线: 只有上一次HTTP请求收到响应后, 才能发出下一次HTTP请求
    - 流水线: 可以连续发出多个HTTP请求
- HTTP/1.0默认采用非持续连接, HTTP/1.1默认采用持续连接.
- ![](../0_Attachment/Pasted%20image%2020241209152220.png)
- ![](../0_Attachment/Pasted%20image%2020241209152321.png)
- ![](../0_Attachment/Pasted%20image%2020241209152326.png)

## 超文本传输协议HTTP

### HTTP报文结构

![](../0_Attachment/Pasted%20image%2020241209151913.png)

### Cookie

- 客户端刚开始访问Web服务器时 (如登录个人账号), 服务器为该客户端生成一个**Cookie识别码**, 并通过HTTP响应报文返回给客户端
- 客户端如果已获得Cookie, 就在每次发出HTTP请求时携带Cookie, 亮明身份
- Cookie识别码相当于给网站的访客制作一张"临时身份证" (一段时间后会**过期**). Cookie识别码需要分别缓存在Web服务器, 客户端.