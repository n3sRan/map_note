# 概述

[TOC]

- 计算机网络学什么?
  - 数据如何通过网络正确, 可靠地从A传送到B

## 计算机网络的概念

计算机网络(Computer networking)是一个将众多分散的, 自治的计算机系统通过通信设备线路连接起来, 由功能完善的软件实现资源共享和信息传递的系统。

### 计算机网络

- 简称网络
- 由若干**结点** node 和连接这些节点的**链路** link 组成
- 常用云朵表示
- 结点可以是计算机, 集线器, 交换机, 路由器等
- 链路可以是有线链路, 无线链路

#### 集线器 Hub 

- 把多个结点连接起来, 组成一个 (简单的) 计算机网络 
- 不能处理数据冲突的情况

#### 交换机 Switch 

- 可以把多个结 点连接起来, 组成一个计算机网络 
- 不会发生冲突
- 家庭, 公司, 学校通常用交换机组建内部网络
- 工作在数据链路层

#### 路由器 Router

- 可以把两个或多个计算机网络互相连接起来, 形成规模更大的计算机网络, 也可以称为**互连网**
- 例子: 银行的内部网络 (总行和多个分行)
- 工作在网络层
- **家用路由器**: 路由器 + 交换机 + 其他功能

### 互连网

- internet
- 多个计算机网络通过路由器互相连接而成
- 可以使用任意通信协议

### 互联网

- 也叫因特网, Internet
- 由各大**ISP**和国际机构组建的, 覆盖全球范围的**互连网**
- ISP: Internet Service Provider, 互连网服务提供商 (中国移动/电信/联通)
- 互联网必须使用**TCP/IP协议**通信 (互连网可以使用任意协议通信)

## 计算机网络的组成

### 按组成部分划分

#### 硬件

- 主机, 即端系统 (end system), 如电脑, 手机和物联网设备, 接入计算机网络之后需要通过**通信设备**和**通信链路**进行数据传输

- 通信设备, 如集线器, 交换机, 路由器

- 通信链路, 如网线, 光纤, 同轴电缆


#### 软件

- 方便用户使用, 实现资源共享, 如Email客户端, 微信, 网盘


#### 协议

- 规定计算机网络中的通信规则

- 由硬件, 软件共同实现

- 端系统内部安装网络适配器 (网卡) 将主机数据发送到网络上 接收来自网络的数据
- 网络适配器内ROM有软件来实现协议 (比如TCP/IP)

### 按工作方式划分

#### 边缘部分

- 直接为用户服务 (通信, 资源共享)
- 主要由连接到互连网上的主机及其软件组成

#### 核心部分

- 为边缘部分提供服务 (连通性, 交换服务)
- 由大量网络和连接这些网络的路由器组成

### 按逻辑功能划分

#### 资源子网

- 计算机网络中运行应用程序, 向用户提供可共享的硬件, 软件和信息资源的部分
- 主要由连接到互联网上的主机组成

#### 通信子网

- 计算机网络中负责计算机间信息传输的部分。即把计算机和其他用户装置互连在一起的所有通信设备和介质的总称。
- 主要由通信链路, 通信设备, 协议构成
- 注:主机内部实现信息传输的网络适配器底层协议 庸于通信子网的范畴

### 功能

- 数据通信: 实现计算机之间的数据传输. 是最基本, 最重要的功能.
- 资源共享
  - 硬件: 智能音响请求服务器处理
  - 软件: 应用商店
  - 数据: 分享视频
- 分布式处理
  - 将复杂任务分配给网络中多台计算机处理 (大矩阵运算)
- 提高可靠性
  - 网络中各台计算机互为替代机 (网盘)
- 负载均衡
  - 网络中各台计算机共同分担繁重工作 (游戏服务器)

## 数据交换

### 电路交换

在电话网络中使用

Circuit Switching, 通过物理线路的连接, 动态地分配传输线路资源

过程

- 建立连接
- 通信
- 释放连接

优点

- 通信前从主叫端到被叫端建立一条专用的物理通路, 在通信的全部时间内, 两个用户始终占用端到端的线路资源. 数据直送, 传输速率高

缺点

- 建立/释放连接需要额外的时间开销
  - 电路交换更适用于低频次, 大量地传输数据, 而计算机之间数据往往是突发式传输, 即高频次, 少量
- 线路被通信双方独占, 利用率低
- 线路分配的灵活性差
- 交换节点不支持差错控制

### 报文交换

在电报网络中使用

存储转发: 把传送的数据单元先存储进中间节点, 再根据目的地址转发至下一节点

报文交换机

报文: message 控制信息 + 用户数据	

优点

- 通信前无需建立连接
- 数据以报文为单位被交换节点间存储转发, 通信线路可以灵活分配
- 在通信时间内, 两个用户无需独占一整条物理线路. 相比于电路交换, 线路利用率高
- 交换节点支持差错控制

缺点

- 报文不定长, 不方便存储转发管理
- 长报文的存储转发时间开销大, 缓存开销大
- 长报文容易出错, 重传代价高

### 分组交换

在现代计算机网络中使用

把不定长的数据分为定长的数据, 添加首部 (Header, 即分组的控制信息, 包含源地址, 目的地址, 分组号等) 形成定长的报文 (Packet)

优点

- 继承了报文交换的优点
- 分组定长, 方便存储转发管理
- 分组的存储转发时间开销小, 缓存开销小
- 分组不易出错, 重传代价低

缺点:

- 相比报文交换, 控制信息占比增加
- 相比电路交换, 依然存在存储转发时延
- 报文被拆分为多个分组, 传输过程中可能出现失序, 丢失等问题, 增加处理的复杂度

### *虚电路交换

基于分组交换

过程

- 建立连接 (虚拟电路)
- 通信 (分组按序, 按已建立号的既定线路发送, 通信双方不独占电路)
- 释放连接

### 性能对比

|                  | 电路交换 | 报文交换 |    分组交换    |
| :--------------: | :------: | :------: | :------------: |
| 完成传输所需时间 |   最少   |   最多   |      较少      |
|   存储转发时延   |    无    |   较高   |      较低      |
|     缓存开销     |    无    |    高    |       低       |
|     差错控制     |  不支持  |   支持   |      支持      |
|   报文数据到达   |   有序   |   有序   |      无序      |
|   额外控制信息   |  不需要  |   需要   | 需要且占比最大 |
|  线路分配灵活性  |  不灵活  |   灵活   |    非常灵活    |
|    线路利用率    |    低    |    高    |     非常高     |

## 计算机网络的分类

### 按分布范围分类

#### **广域网** 

- WAN Wide Area Network
- 范围: 几十-几千公里, 跨省, 跨国, 跨洲

#### 城域网 

- MAN Metropolitan Area Network
- 范围: 几十米-几千米
- 一个或几个相邻城市
- 常采用以太网技术

#### **局域网** 

- LAN Local Area Network
- 范围: 几十米-几千米
- 学校, 企业, 工作单 位, 家庭
- 通信技术: 以太网技术(常用, 以太网也成了局域网的代名词)
- 家用交换机: 以太网交换机

#### 个域网 

- PAN Personal Area Network
- 范围: 几十米以内
- 家庭, 个人
- 无线技术 (蓝牙等) 实现, 通常也称为无线个域网 WPAN

### 按传输技术分类

#### 广播式网络

当一台计算机发送数据分组时, 广播范围内所有计算机都会收到该分绍, 并通过检查分组的目的地址决定是否接收该分组 (群里@某个人), 例如无线网络

#### 点对点网络

数据只会从发送方点对点发到接收方, 精准送达 (私信), 例如路由器转发的数据分组

### 按拓扑结构分类

前三种常见于局域网, 最后一种常见于广域网

#### 总线形结构

数据**广播式传输**, 存在**总线争用**的问题, 例如集线器连接的设备 (集线器在物理上是星形, 逻辑上是总线形)

#### 环形结构

数据**广播式传输**, 通过令牌 (token) 解决了总线争用的问题, 令牌顺环形依次传递, 拿到令牌着可以使用总线

#### 星形结构

由中央设备实现数据的**点对点传输**, 不存在总线争用问题, 例如以太网交换机连接的设备 (物理和逻辑上均是星形结构)

#### 网状结构

数据通过各中间节点逐一存储转发, 属于**点到点传输**, 例如由众多路由器构建的广域网

灵活, 可靠性高, 控制复杂, 线路成本高

### 按使用者分类

#### 公用网

向公众开放的网络, 例如办宽带, 交手机话费即可使用的互联网

#### 专用网

仅供某个组织内部使用的网络, 例如银行内部网络

### 按传输介质分类

#### 有线网络

#### 无线网络

## 计算机网络的性能指标

### 速率

- 信道
  - Channel, 表示向某一方向传送信息的通道 (信道≠通信线路), 一条通信线路在逻辑上往往对应一条**发送信道**和一条**接收信道**
- 速率
  - Speed, 指连接到网络上的节点在信道上传输数据的速率. 也称数据率或比特率, **数据传输速率**
- 速率单位
  - bit/s = b/s = bps, 1B/s = 8b/s, 基数为10

### 带宽 

- Bandwidth
- 在**计算机网络**中
  - 指某个信道所能传送的最高数据率, 单位: bps
  - 节点间通信实际能达到的最高速率, 由带宽, 节点性能共同限制
- 在**通信原理**中
  - 指某信道允许通过的信号频带范围, 单位: Hz
  - 类比: 人眼的带宽 
- 本质: 信道 (在传播电磁波信号)  带宽越大, 传输数据的能力越强
  - 光纤带宽: 500MHz, 电话线带宽: 3kHz, 因此用光纤实现的网络通信通常可以达到更高的数据率
  - 香农定理, 奈式准则

### 吞吐量

- Throughout
- 指单位时间内通过某个网络 (或信道 (网线等), 接口(网卡等)) 的实际数据量. 吞吐量受带宽限制, 受复杂的网络负载情况影响.

### 时延

Delay

指数据 (一个报文或分组, 甚至比特) 从网络 (或链路 )的一端传送到另一端所需的时间, 有时也称为延迟或迟延.

总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延

- 发送时延
  - 又名传输时延, 指节点将数据推向信道所花的时间, = 数据长度 (bit) / 发送速率 (bit/s)
- 传播时延
  - 区别与传输时延
  - 电磁波在信道中传播一定距离所花的时间, = 信道长度 (m) / 电磁波在信道中的传播速度 (m/s)
- 处理时延
  - 数据被路由器处理所花的时间 (如: 分析首部, 查找存储装发表)
- 排队时延
  - 数据排队进入排队发出路由器所花的时间
  - 路由器有输入/输出队列 (缓冲区)

### 时延带宽积

时延带宽积 = 传播时延 × 带宽

含义: 一条链路中, 已从发送端发出但尚未到达接收端的最大比特数 (类比: 数据链路: 水管, 带宽: 水管横截面, 传播时延: 水管长度, 带宽积: 水管最多能容纳多少水)

用于设计最短帧长

### 往返时延

RTT Round-Trip Time, 表示从发送方**发送完数据**, 到发送方**收到来自接收方的确认**总共经历的时间

$RTT= t_2 + t_3 + t_4 + t_5$

$t_1$: 发送方发送数据的发送时延, 不计入RTT

$t_2$: 数据的单向传播时延

$t_3$: 接收方收到数据后的处理时延

$t_4$: "确认"消息的发送时延

$t_5$: "确认"消息的传播时延 (= $t_2$)

例如: 游戏延迟

### 信道利用率

信道利用率: 某个信道有百分之多少的时间是有数据通过的.

信道利用率 = 有数据通过的时间 / (有数据通过的时间 + 没有数据通过的时间)

太低: 浪费资源

太高: 容易导致网络堵塞

网络利用率: 网络中所有信道的信道利用率的加权平均

## 计算机网络分层结构

### 分层

类比: 快递

- 有快递终点站, 快递中转站, 快递员, 顾客...
- 将复杂的快递网络在逻辑上划分为多个层次, 并将各种功能安排在合适的层次中, 不同类型的节点实现的功能层次可能不一样

**分层**的设计思想: 将庞大而复杂的问题, 转化为若干较小的局部问题   

- 将复杂的计算机网络在逻辑上划分为多个层次, 并将各种“功能”安排在合适的层次中.
- 分层结构的设计并不唯一, 可以根据实际需求增加或减少层次.

### 三种常见的计算机网络体系结构

- OSI参考模型: 法律上的标准, 7层
- TCP/IP模型: 事实上的标准, 4层
- 五层模型: 教学用标准

### 网络的体系结构

- Network Architecture, 是计算机网络的各层及其协议的集合, 就是这个计算机网络及其构件所应完成的功能的精确定义 (不涉及实现)
- 实现 (implementation) 是遵循这种体系结构的前提下, 用何种硬件或软件完成这些功能的问题.
- 体系结构是**抽象**的, 而实现则是具体的

### 各层之间的关系

**实体**: 在计算机网络的分层结构中, 第n层中的活动元素 (软件+硬件) 通常称为第n层实体. 不同机器上的同一层称为对等层, 同一层的实体称为**对等实体**.

**协议**: 即网络协议 Network Protocol, 是控制对等实体之间进行通信的规则的集合, 是**水平**的

- 协议由语法, 语义, 同步三部分组成
- 语法: 数据与控制信息的格式
- 语义: 即需要发出何种控制信息, 完成何种动作, 以及做出哪种应答
- 同步: 执行各种操作的条件, 时序关系等, 即事件实现顺序的详细说明

**接口**: 即同一节点内相邻两层的实体交换信息的逻辑接口, 又称为**服务访问点**(Service Access Point,SAP)

**服务**:服务是指 下层为紧邻的上层提供的功能调用, 它是**垂直**的.

#### 数据传输的过程 (水平视角)

在用户看来, 数据似乎是被原模原样传输的, 用户感知不到数据被压缩, 解压的过程

应用层 (第5层): 使用压缩传输协议, 发送方将数据压缩后, 需要增加首部, 说明采用了哪种压缩算法, 接收方根据首部信息选择压缩算法将数据解压. 

为什么要分层和制定协议?

计算机网络功能复杂→采用分层结构, 将诸多功能合理地划分在不同层次→对等层之间制定协议, 以实现功能。

#### 数据传输的过程 (垂直视角)

往下传输: 增加首部/尾部

往上传输: 分析首部/尾部, 实现功能

协议数据单元 PDU: 对等层次之间传送的数据单位。第n层的PDU记为n-PDU

服务数据单元 SDU: 为完成上一层实体所要求的功能而传送的数据. 第n层的SDU记为n-SDU.

协议控制信息 PCI: 控制协议操作的信息, 第n层的PCL记为n-PCI

n-SDU + n-PCI = n-PDU = (n-1)-SDU

## OSI参考模型

各层名称速记: 物联网叔会使用

### 常见网络设备功能层次  

主机 #1-#7

集线器 #1

交换机 #1-#2

路由器 #1-#3

各个节点之间使用物理传输媒体进行连接 (第0层)

### 1#物理层

任务: 实现相邻节点之间比特的传输

需定义电路接口参数 (如:形状, 尺寸, 引脚数等)

需定义传输信号的含义, 电气特征 (如:5V表示1, 1V表示0; 每比特电信号持续时间0.1ms)

无法控制出错

传输单位: **比特** bit

### 2#数据链路层

链路层任务:确保相邻节点之间的链路逻辑上无差错包含以下功能

差错控制:检错+纠错;或检错+丢弃+重传

流量控制:协调两个结点的速率

传输单位: **帧** Frame 含多个比特 需使用校验编码技术 (例如1字节+2个校验位)

### 3#网络层

任务: 把“分组”从源结点转发到目的结点。包含以下功能

路由选择: 构造并维护路由表，决定分组到达目的节点的最佳路径

分组转发: 将“分组”从合适的端口转发出去

拥塞控制: 发现网络拥塞，并采取措施缓解拥塞

网际互联: 实现异构网络互联

其他功能: 差错控制, 流量控制 (以分组为单位进行, 因为数据链路层只能保证每个帧是正确的即局部正确, 却不能保证整个分组是正确的即全局正确), 连接建立与释放 (确保分组有序, 不重复到达), 可靠传输管理 (接收方需返回分组确认信息).

传输单位: **分组** Packet, 又称数据报

### 4#传输层

任务: 实现端到端通信 (即实现进程到进程的通信, "端"指"端口")

复用和分用

多个进程可以通过端口号去请求传输层的服务 (传输层的复用)

其他功能: 差错控制, 流量控制 (以报文段为单位进行), 连接建立与释放 (确保报文段有序, 不重复到达), 可靠传输管理 (接收方需返回报文段确认信息).

在数据的接收方, 传输层会哦通过端口号把数据分派给对应的进程 (传输层的分用)

传输单位: **报文段** Segment

### 5#会话层

任务: 管理进程间会话

会话管理 (采用检查点机制, 当通信失效时从检查点继续恢复通信, 类似于文件断点续传)

### 6#表示层

任务: 解决不同主机上信息表示不一致的问题

数据格式转换, 例如编码转换, 压缩/解压缩, 加密/解密

### 7#应用层

任务: 实现特定的网络应用

传输单位: **报文** Message

5,6层不会对报文的单位进行拆分

### 各层数据传输

从高到低: 数据分段

从低到高: 数据重装

## TCP/IP模型

各层名称速记: 接网叔用

### 对比OSI#5-#7

并不是所有网络应用都需要数据格式转换, 会话管理功能

TCP/IP的理念: 没有会话层和表示层, 如果某些应用需要数据格式转换, 会话管理功能, 就交给应用层的特定协议去实现

4#应用层: 包含了OSI中的表示层和会话层

### 对比OSI#1-#2

网络硬件种类繁多, 不应该有过多限制

1#网络接口层

任务: 实现相邻节点间的数据传输 (为网络层传输分组), 但具体怎么传输不作规定

使得TCP/IP网络体系结构具有更强的灵活性, 适应性

### TCP/IP 2#网络层

功能: 路由选择, 分组转发, 拥塞控制, 网际互联 (没有差错控制等功能)

只保证"尽最大能力交付", 数据传输是不可靠的

### TCP/IP 3#传输层

功能: 复用和分用, 差错控制, 流量控制, 连接建立与释放, 可靠传输管理.

全局正确可以推出局部正确 

使得网络的核心部分 (路由器) 的功能简单, 负载低   

### 对比

- OSI网络层可向上层提供
  - 有连接可靠的服务 (虚电路) (开启差错控制, 流量控制, 连接建立与释放, 可靠传输管理功能)
  - 无连接不可靠的服务 (数据报)
- TCP/IP网络层仅向上层提供
  - 无连接不可靠的服务 (数据报)
- OSI传输层仅可向上层提供:
  - 有连接的可靠的服务
- TCP/IP传输层可向上层提供
  - 有连接可靠的服务 (TCP协议)
  - 无连接不可靠的服务 (UDP协议)

